{% extends 'base.html.twig' %}


{% block title %}BALISES{% endblock %}

{% block stylesheets %}
    {{ parent() }}
    <link href='https://api.mapbox.com/mapbox.js/v3.2.0/mapbox.css' rel='stylesheet' />
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.3.1/dist/leaflet.css" integrity="sha512-Rksm5RenBEKSKFjgI3a41vrjkw4EVPlJ3+OiI65vTjIdo9brlAacEuKOiQ5OFh7cOI1bkDwLqdLw3Zg0cRJAAQ=="
          crossorigin="" />

    <link rel="stylesheet" type="text/css" href="https://unpkg.com/leaflet.markercluster@1.3.0/dist/MarkerCluster.css" />
    <link rel="stylesheet" type="text/css" href="https://unpkg.com/leaflet.markercluster@1.3.0/dist/MarkerCluster.Default.css" />

    <style type="text/css">
        #map{ /* la carte DOIT avoir une hauteur sinon elle n'apparaît pas */
            height: 100%;
        }

        .sidenav
        {
            background-color: #FFEC02;
        }


        // manage the map with title, logo, ...

        #map

           {
               z-index: 0;
               width:100%;
           }

        #selectplacetitle
        {
            position: absolute;
            top: 60%;
            left: 7%;
            z-index: 1;
            color: black;
            font-size: 80px;

        }


        #selectplacetitle h1
        {
            font-size: 80%;
            font-weight: bold;
        }

        #selectplacetitle span
        {
            color: white;
            font-weight: bold;
        }

        #logoonmap
        {
            position: absolute;
            bottom: 40px;
            right: 2px;
            z-index: 1;
            transform: scale(0.7, 0.7);
        }



        .popupCustom .leaflet-popup-tip
        {
            display: none;
        }

        .popupCustom .leaflet-popup-content-wrapper {
            box-shadow : none;
            background: none;
            color: white;
            height: 800px;
            width: 1000px;
        }

        .jumbotron
        {
            padding: 2%;
        }

        .bulleInfo
        {
            font-size: x-small;
            background: none;
            display: none;
            z-index: 2;
            position: fixed;
            bottom: -50%;


        }

        .bulleInfo1
        {
            margin-top: 50%;
            background-color: grey;
            color: white;
        }

        .bulleInfo2
        {

        }

        .bulleInfo3
        {
            margin-top: 50%;
            background-color: black;
            color: white;
            height: 250px;
            border-style: solid;
            border-color: black;

        }

        /* width */
        .bulleInfo3::-webkit-scrollbar {
            width: 20px;
        }

        /* Handle */
        .bulleInfo3::-webkit-scrollbar-thumb {
            background: yellow;
            border-radius: 10px;
        }


        .bulleInfo4
        {

        }

        .bulleInfo5
        {

        }

        .bulleInfo6
        {
            background-color: grey;
            color: white;
            height: 250px;
            overflow: auto;
            margin-top: -50%;
        }

        .bulleInfo1Photo
        {
            max-width: 100%;
        }

        .jumbotron h1
        {
            font-size: 20px;
        }

        .jumbotron p
        {
            font-size: 15px;
        }


    </style>
{% endblock %}



{% block body %}




    <div class="popupCustom" id="map">
    </div>



    <div id="selectplacetitle">


        <img id="jumelles" style="max-width: 80px" src="https://img.icons8.com/metro/420/opera-glasses.png">

        <h1>SÉLECTIONNER</h1>
        <h1> VOTRE <span>LIEU</span></h1>
    </div>

    <div id="logoonmap">
        <a href="{{ path('home') }}"><img src="http://www.balises-theatres.com/img/Logo_balises_rond.png"/></a>
    </div>



    <!-- Info Bulle -->

    {% for theater in theaters %}

        <div class="bulleInfo" id="theater{{ theater.id }}">
            <div class="container-fluid">
                <div class="row bulleinfo">

                    <div class="col-5">
                        <div class="jumbotron bulleInfo1">
                            <img src="{{ theater.logo }}" style="max-width: 100%; display: block; margin-left: auto; margin-right: auto; padding-bottom: 5%">
                            <br>
                            <h1 style="color : Yellow; font-weight: bold; text-align: right" class="display-4">{{ theater.name }}</h1>
                            <p class="lead" style="text-align: right">{{ theater.address1 }}</p>
                            <p class="lead" style="text-align: right">{{ theater.zipcode }} {{ theater.city }}</p>
                            <p class="lead" style="text-align: right">{{ theater.phoneNumber }}</p>
                        </div>
                        <img src="{{ theater.picture }}" style="max-width: 50%; padding-bottom: 5%;float: right">
                    </div>

                    <div class="col-2">
                        <div class="bulleInfo2">

                        </div>
                    </div>

                    <div class="col-5">
                        <div class="jumbotron bulleInfo3">
                            <h1 style="color : Yellow; font-weight: bold" class="display-4">{{ theater.name }}</h1>
                            <hr style="background-color : white; text-align : center; line-height: 1;";>
                            <h3 style="color : white; font-weight: bold" >CHOIX DE VOTRE SPECTACLE</h3>

                            {% for spectacle in spectacles %}
                                {% if spectacle.theater == theater %}
                                    <input type="checkbox" name="checkbox" id="checkbox">
                                    <label for="checkbox" style="font-size: 20px">{{ spectacle.title }}<img src="http://pngimg.com/uploads/plus/plus_PNG41.png" style="max-height: 10px"></label>
                                    <p style="margin-top: -2%">{{ spectacle.distribution }}</p>


                                {% endif %}
                            {% endfor %}

                        </div>
                    </div>

                    <div class="col-5">
                        <div class="bulleInfo4">

                        </div>
                    </div>

                    <div class="col-2">
                        <div class="bulleInfo5">

                        </div>
                    </div>

                    <div class="col-5">
                        <div class="jumbotron bulleInfo6">
                            <h3 style="color : white; font-weight: bold" >SELECTIONNEZ LA DATE DE VOTRE SPECTACLE</h3>

{#                            {% for showdate in showdates %}#}
{#                                {% if showdate.showId == spectacle.theater %}#}
{#                                    <ul>#}
{#                                        <li class="lead">{{ showdate.dateShow }}</li>#}
{#                                    </ul>#}

{#                                {% endif %}#}
{#                            {% endfor %}#}
                        </div>
                    </div>

                </div>
            </div>
        </div>


    {% endfor %}




{% endblock %}



{% block javascripts %}
    {{ parent() }}
    <script src='https://api.mapbox.com/mapbox.js/v3.2.0/mapbox.js'></script>


    <script>
        // On initialise la latitude et la longitude de Lyon (centre de la carte)
        let lat = 45.75;
        let lon = 4.85;
        let zoom = 13; // Zoom de la carte par défaut

        L.mapbox.accessToken = 'pk.eyJ1IjoiYmFsaXNlcyIsImEiOiJjandqZThmaXIwZzF5NDhvNWE0eWhxbThjIn0.L-XJu_ElG2aGqQx4ZijbIg';
        let map = L.mapbox.map('map')
            .setView([lat, lon], zoom)
            .addLayer(L.mapbox.styleLayer('mapbox://styles/balises/cjwkvbvvf0b7i1cr4s3z4aqxk'));


        let customOptions =
            {
                'maxWidth': '100%',
                'width': '100%',
                'className' : 'popupCustom',
            };

        // Récupération coordonnées GPS dans tableau JS :
        let pointers =
            [
                {% for theater in theaters %}
                {
                    lat : '{{ theater.lat }}',
                    long : '{{ theater.longitude }}',
                    id : '{{ theater.id }}',
                },
                {% endfor %}
            ];


        for (let i = 0; i < pointers.length; i++)

        {
            let latitude = pointers[i].lat;
            let longitude = pointers[i].long;
            let pointerId = pointers[i].id;
            let elements = document.getElementById('theater'+ pointerId);
            let hideAction = document.getElementById('selectplacetitle');
            hideAction.style.display = "block";

            let marker = L.marker([latitude, longitude]).addTo(map);


            // bind the custom popup

            marker.bindPopup(elements, customOptions);


            marker.addEventListener("click",function ()
            {
                elements.style.display = "block";
                hideAction.style.display = "none";
                map.setView([latitude, longitude]);

            });


        }


        map.addEventListener("click", function ()
        {
            let hideAction = document.getElementById('selectplacetitle');
            hideAction.style.display = "block";
            map.setView([latitude, longitude]);


        });
        let clickontitle = document.getElementById('selectplacetitle');
        clickontitle.addEventListener("click", function()
        {
            map.setView([lat, lon], zoom);
        })






    </script>


{% endblock %}
