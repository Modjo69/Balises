{% extends '/basePage.html.twig' %}

{% block stylesheet %}

{% endblock %}

{% block body %}


<div class="container bg-custom h-100">


        <h1 class="h1">La programmation Balise</h1>
        <h4 class="h4">Saison {{ period.year }} - {{ period.year+1 }}</h4>


    <div class="row p-4 border-top border-bottom bg-light">
        {% for month in months |slice(period.month-1 ,12) %}
            <div class="col-md-1">
                <!--monthNumber gets the right value to send to the method async_calendar as a month date. -->
                {% set monthNumber = loop.index+period.month-1 %}
                <button class="calendarButton hvr-float-shadow py-1" id="month{{ loop.index }}" onclick="changeDate
                        ('{{ path
                    ('async_calendar', {"day" : period.year ~ "-" ~ monthNumber ~ "-01"})}}', {{ loop.index }})">
                    {{ month }} {{ period.year |slice(2,2) }}</button>
            </div>
        {% endfor %}


        {% for month in months |slice(0, period.month-1 ) %}
            <div class="col-md-1">
                <!--nextYear gets the right value to send to the method async_calendar as a year formatted(here it
                must be year +1 -->
                {% set nextYear = period.year+1 %}
                <button class="calendarButton hvr-float-shadow" id="month{{ loop.index+period.month-1 }}" onclick="changeDate('{{ path
                    ('async_calendar', {"day"
                        : nextYear ~ "-" ~ loop.index ~ "-01"})
                }}', {{ loop.index+period.month-1 }})">
                    {{ month }} {{ nextYear |slice(2,2) }}</button>
            </div>
        {% endfor %}

    </div>
    <hr class="hr-dark">
    <!-- Div dedicated to ajax new spectacle -->
    <div id="newSpectacles">

    </div>


    <div id="display-spectacles">
        <!-- below the display of spectacles. Same as the ones in search by theater. -->
            <h4 class="h4">Au programme ce mois</h4>


        {% for spectacle in spectaclesOfTheDay%}

            <div  class="row row-striped border-bottom p-4">
                <div class="col-12 col-md-1 text-right">

                    <h1 class="display-4"><span class="badge badge-secondary day-figure" id="dayNumberSpectacle"
                                                >{{
                            spectacle.dateShow | date('d')}}</span></h1>
                    <h4 class="h4">{{ spectacle.dateShow | date('M')}}</h4>
                </div>
                <div class="col-md-6">
                    <a href="{{ path('detailSpectacle', {"id": spectacle.showId.id}) }}" target="_blank">
                        <h3 class="text-uppercase show-title">
                            <strong>{{ spectacle.showId.title }}</strong></h3></a>
                    <img class="img" src="{{ spectacle.showId.image }}">
                </div>
                <div class="col-12 col-md-5">

                    <ul class="list-inline">
                        <li class="list-inline-item show-info"><i class="fa fa-clock-o" aria-hidden="true"></i>
                            {{ spectacle.dateShow | date('D') }}
                            {{ spectacle.dateShow | date('d.m.Y à H:i') }} - {{ spectacle.dateShow |date_modify('+ 3 hours') | date('H:i')}}
                        </li>
                        <a href="{{ path('map2') }}?theater=theater{{ spectacle.showId.theater.id }}"><li
                                    class="list-inline-item calendarLink"><i class="fa fa-location-arrow"
                                                                             aria-hidden="true"></i>
                                {{ spectacle.showId.theater.name }} </li></a>
                    </ul>

                    <p class="description">{{ spectacle.showId.description | truncate(400) }}
                        <a href="{{ path('detailSpectacle', {"id": spectacle.showId.id}) }}" target="_blank"
                           class="calendarLink">Voir plus</a>
                    </p>

                    <a href="https://54yzsyel.mapado.com/en/"><button class="calendarButton hvr-float-shadow">Offre
                            balise</button></a>


                </div>
                <!--
                <div class="col-6 col-md-2 m-auto">


                </div>-->
            </div>
        {% endfor %}
        <div class="row justify-content-center p-4" id="plus-button">
            <h4 class="h4 hvr-float-shadow" style="opacity: 0.8; cursor: pointer;" onclick="nextDay('{{ path
                ('async_calendarPlusOne', {"day" : today |
                date_modify('+ 1 day') | date('Y-m-d')
            }) }}')"><i class="fas fa-plus"></i> Ce mois </h4>
            <div class="col-1 offset-1 ">
                <div ></div>
            </div>
        </div>

    </div>
    <div id="spectaclesNextDay" class="row row-striped">

    </div>







</div>
{% endblock %}

{% block javascripts %}

    <script>
        //Cette fonction gère l'affichage des spectacles quand on clique dans le calendrier carousel
        function changeDate(date, clickedPill) {
            fetch(date)
                .then(response => response.text())
                .then(text =>  {
                    let displaySpectacles = document.getElementById('display-spectacles');
                    let spectaclesNextDay = document.getElementById('spectaclesNextDay');
                    let newSpectacles = document.getElementById('newSpectacles');

                    displaySpectacles.remove();

                    spectaclesNextDay.innerHTML ='';

                    newSpectacles.innerHTML = text;
                });

            let month=[];
            for(let i = 1; i <= 12; i++) {

                month[i] = document.getElementById('month'+i);
                month[i].classList.remove('active');
            }
            //puis on ajoute un design indiquant la case selectionné
            month[clickedPill].classList.add('active');
            console.log(month[clickedPill]);
        }
        /*les 3 fonctions ci-dessous gèrent l'affichage des spectacles quand on clique sur les pills (aujourd'hui, 3
         jours, 1 semaine) */
        function changeDateToday(date) {
            fetch(date)
                .then(response => response.text())
                .then(text => {
                    let displaySpectacles = document.getElementById('display-spectacles');
                    let spectaclesNextDay = document.getElementById('spectaclesNextDay');
                    let newsspectacleDisplay = document.getElementById('newSpectacles');
                    //Remets toutes les cases dans le carousel en mode inactif, sans design particulier
                    let day=[];
                    for(let i = 0; i< 14; i++) {

                        day[i] = document.getElementById('day'+i);
                        day[i].classList.remove('active');
                    }
                    //puis on ajoute un design indiquant la case selectionné sur le premier jour ici
                    day[0].classList.add('active');

                    displaySpectacles.remove();

                    spectaclesNextDay.innerHTML ='';

                    newSpectacles.innerHTML = text;

                    let datePills = document.querySelectorAll('.timePill');

                    datePills.forEach(function (value, index, datePills) {
                        value.classList.remove('activeTimePill');
                    });
                    datePills[0].classList.add('activeTimePill');
                });
        }

        function changeDate3days(date) {
            fetch(date)
                .then(response => response.text())
                .then(text => {
                    let displaySpectacles = document.getElementById('display-spectacles');
                    let spectaclesNextDay = document.getElementById('spectaclesNextDay');
                    let newsspectacleDisplay = document.getElementById('newSpectacles');
                    //Remets toutes les cases dans le carousel en mode inactif, sans design particulier
                    let day=[];
                    for(let i = 0; i< 14; i++) {

                        day[i] = document.getElementById('day'+i);
                        day[i].classList.remove('active');
                    }
                    //puis on ajoute un design indiquant la case selectionné sur le premier jour ici
                    day[0].classList.add('active');

                    displaySpectacles.remove();

                    spectaclesNextDay.innerHTML ='';

                    newSpectacles.innerHTML = text;

                    let datePills = document.querySelectorAll('.timePill');

                    datePills.forEach(function (value, index, datePills) {
                        value.classList.remove('activeTimePill');
                    });
                    datePills[1].classList.add('activeTimePill');
                });
        }

        function changeDate1Week(date) {
            fetch(date)
                .then(response => response.text())
                .then(text => {
                    let displaySpectacles = document.getElementById('display-spectacles');
                    let spectaclesNextDay = document.getElementById('spectaclesNextDay');
                    let newsspectacleDisplay = document.getElementById('newSpectacles');
                    //Remets toutes les cases dans le carousel en mode inactif, sans design particulier
                    let day=[];
                    for(let i = 0; i< 14; i++) {

                        day[i] = document.getElementById('day'+i);
                        day[i].classList.remove('active');
                    }
                    //puis on ajoute un design indiquant la case selectionné sur le premier jour ici
                    day[0].classList.add('active');

                    displaySpectacles.remove();

                    spectaclesNextDay.innerHTML ='';

                    newSpectacles.innerHTML = text;

                    let datePills = document.querySelectorAll('.timePill');

                    datePills.forEach(function (value, index, datePills) {
                        value.classList.remove('activeTimePill');
                    });
                    datePills[2].classList.add('activeTimePill');
                });
        }

        function nextDay(date) {
            fetch(date)
                .then(response => response.text())
                .then(text =>  {
                    let spectaclesNextDay = document.getElementById('spectaclesNextDay');

                    if(spectaclesNextDay.innerHTML !=null){
                        spectaclesNextDay.innerHTML = text;
                    }
                    else{
                        spectaclesNextDay.innerHTML = '';
                        spectaclesNextDay.innerHTML = text;
                    }
                });
        }


        function active(clickedPill) {
            //Remets toutes les cases dans le carousel en mode inactif, sans design particulier
            let month=[];
            for(let i = 1; i <= 12; i++) {

                month[i] = document.getElementById('month'+i);
                month[i].classList.remove('active');
            }
            //puis on ajoute un design indiquant la case selectionné
            month[clickedPill].classList.add('active');

        }


    </script>

</div>
{% endblock %}
